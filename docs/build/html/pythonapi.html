<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Python API &mdash; berryMQ v0.1 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="berryMQ v0.1 documentation" href="index.html" />
    <link rel="next" title="Ruby API" href="rubyapi.html" />
    <link rel="prev" title="Introduction" href="intro.html" />
        <link rel=stylesheet type="text/css" href="_static/berrymq.css">   

  </head>
  <body>
<div style="background-color: white; margin: 0px 0px 0px 0px; width: 100%; padding-left: 50px;">
<img src="_static/berrymq.png" alt="berryMQ logo"/>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             accesskey="M">modules</a> |</li>
        <li class="right" >
          <a href="rubyapi.html" title="Ruby API"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">berryMQ top</a>&nbsp;|&nbsp;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-berrymq">
<h1>Python API<a class="headerlink" href="#module-berrymq" title="Permalink to this headline">¶</a></h1>
<div class="section" id="decorators">
<span id="index-20"></span><h2>Decorators<a class="headerlink" href="#decorators" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="berrymq.following">
<tt class="descclassname">berrymq.</tt><tt class="descname">following</tt><big>(</big><em>identifier</em><span class="optional">[</span>, <em>guard_condition</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#berrymq.following" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a decorator function. This decorator can use for only instanse methods of the classes which use <a title="berrymq.Follower" class="reference internal" href="#berrymq.Follower"><tt class="xref docutils literal"><span class="pre">Follower</span></tt></a> metaclass.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>identifier</em> (str) &#8211; receive message filter <a class="reference external" href="intro.html#identifier"><em>Identifier</em></a>.</li>
<li><em>guard_condition</em> (callable object with one paramater(message object)) &#8211; if this guard function return False, message receive will be skipped</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">class <a title="berrymq.Follower" class="reference internal" href="#berrymq.Follower"><tt class="xref docutils literal"><span class="pre">Follower</span></tt></a>, function <a title="berrymq.following_function" class="reference internal" href="#berrymq.following_function"><tt class="xref docutils literal"><span class="pre">following_function()</span></tt></a></p>
</div>
</dd></dl>

<dl class="function">
<dt id="berrymq.following_function">
<tt class="descclassname">berrymq.</tt><tt class="descname">following_function</tt><big>(</big><em>identifier</em><span class="optional">[</span>, <em>guard_condition</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#berrymq.following_function" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a decorator function. This decorator can use for only class methods, static methods, functions. if you want to use for instance methods, use <a title="berrymq.following" class="reference internal" href="#berrymq.following"><tt class="xref docutils literal"><span class="pre">following()</span></tt></a> instead of this function.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>identifier</em> (str) &#8211; receive message filter <a class="reference external" href="intro.html#identifier"><em>Identifier</em></a>.</li>
<li><em>guard_condition</em> (callable object with one paramater(message object)) &#8211; if this guard function return False, message receive will be skipped</li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last">function <a title="berrymq.following_function" class="reference internal" href="#berrymq.following_function"><tt class="xref docutils literal"><span class="pre">following_function()</span></tt></a></p>
</div>
</dd></dl>

<dl class="function">
<dt id="berrymq.auto_twitter">
<tt class="descclassname">berrymq.</tt><tt class="descname">auto_twitter</tt><big>(</big><em>identifier</em><span class="optional">[</span>, <em>entry</em><span class="optional">[</span>, <em>exit</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#berrymq.auto_twitter" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a decorator function.
The decorated function is called, automatically sends message.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@auto_twitter</span><span class="p">(</span><span class="s">&quot;function&quot;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sample_function</span><span class="p">():</span>
    <span class="o">...</span> <span class="n">do</span> <span class="n">something</span>
</pre></div>
</div>
<p>If this function is called, <tt class="docutils literal"><span class="pre">function:entry</span></tt> message will be sent before running function, and then <tt class="docutils literal"><span class="pre">function:exit</span></tt> message will be sent after running function.</p>
<p>Use <tt class="docutils literal"><span class="pre">entry</span></tt>, <tt class="docutils literal"><span class="pre">exit</span></tt> parameter for controlling message.</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="18%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">entry</th>
<th class="head">exit</th>
<th class="head">action</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>False</td>
<td>False</td>
<td>send both.</td>
</tr>
<tr><td>False</td>
<td>True</td>
<td>exit message only</td>
</tr>
<tr><td>True</td>
<td>False</td>
<td>entry message only</td>
</tr>
<tr><td>True</td>
<td>True</td>
<td>send both.</td>
</tr>
</tbody>
</table>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><em>identifier</em> (str) &#8211; Send message :ref:<tt class="docutils literal"><span class="pre">identifier</span></tt></li>
<li><em>entry</em> (True or False) &#8211; Send message before calling function?(default: False)</li>
<li><em>exit</em> (True or False) &#8211; Send message after calling function?(default: False)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="functions">
<span id="index-21"></span><h2>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="berrymq.twitter">
<tt class="descclassname">berrymq.</tt><tt class="descname">twitter</tt><big>(</big><em>identifier</em><span class="optional">[</span>, <em>...</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#berrymq.twitter" title="Permalink to this definition">¶</a></dt>
<dd>Send message. It is the most important function in berryMQ.
This funciton can recieve any args and kwargs. These values are delivered
via <a title="berrymq.Message" class="reference internal" href="#berrymq.Message"><tt class="xref docutils literal"><span class="pre">Message</span></tt></a> object.</dd></dl>

<dl class="function">
<dt id="berrymq.talk">
<tt class="descclassname">berrymq.</tt><tt class="descname">talk</tt><big>(</big><em>identifier</em>, <em>callback_identifier</em><span class="optional">[</span>, <em>...</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#berrymq.talk" title="Permalink to this definition">¶</a></dt>
<dd><p>Send message like <a title="berrymq.twitter" class="reference internal" href="#berrymq.twitter"><tt class="xref docutils literal"><span class="pre">twitter()</span></tt></a> method. This function has callback
identifer. All receivers call back to this <a class="reference external" href="intro.html#identifier"><em>Identifier</em></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is planning feature. It isn&#8217;t implemented yet.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="berrymq.set_multiplicity">
<tt class="descclassname">berrymq.</tt><tt class="descname">set_multiplicity</tt><big>(</big><em>number</em><big>)</big><a class="headerlink" href="#berrymq.set_multiplicity" title="Permalink to this definition">¶</a></dt>
<dd>This function is set thread pool size.</dd></dl>

</div>
<div class="section" id="classes">
<h2>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="berrymq.Follower">
<em class="property">class </em><tt class="descclassname">berrymq.</tt><tt class="descname">Follower</tt><a class="headerlink" href="#berrymq.Follower" title="Permalink to this definition">¶</a></dt>
<dd><p>If you want to use the method as receiver, set this class as metaclass.</p>
<p>In python 2.4 - 2.6:</p>
<div class="highlight-python"><pre># Python 2.4, 2.5, 2.6
class Logger(object):
    __metaclass__ = Follower
   @following("*:log")
   def receive_log(self, message):
       ...</pre>
</div>
<p>In python 3.0 -:</p>
<div class="highlight-python"><pre># Python 3.0, 3.1
class Logger(metaclass=Follower):
   @following("*:log")
   def receive_log(self, message):
       ...</pre>
</div>
<p>If you use Ruby, This class provide special decorators. <a title="berrymq.following" class="reference internal" href="#berrymq.following"><tt class="xref docutils literal"><span class="pre">following()</span></tt></a>
and <a title="berrymq.auto_twitter" class="reference internal" href="#berrymq.auto_twitter"><tt class="xref docutils literal"><span class="pre">auto_twitter()</span></tt></a>. Use like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span class="c1"># Ruby</span>
<span class="k">class</span> <span class="nc">Logger</span>
  <span class="kp">include</span> <span class="no">BerryMQ</span><span class="o">::</span><span class="no">Follower</span>

  <span class="n">following</span><span class="p">(</span><span class="s2">&quot;*:log&quot;</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">receive_log</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
     <span class="o">.</span><span class="n">.</span><span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="berrymq.Message">
<em class="property">class </em><tt class="descclassname">berrymq.</tt><tt class="descname">Message</tt><a class="headerlink" href="#berrymq.Message" title="Permalink to this definition">¶</a></dt>
<dd><p>This object is created in berryMQ automatically.
User doesn&#8217;t create this object directly.</p>
<p>All of following attributes are readonly(defined as property).</p>
<dl class="attribute">
<dt id="berrymq.Message.name">
<tt class="descname">name</tt><a class="headerlink" href="#berrymq.Message.name" title="Permalink to this definition">¶</a></dt>
<dd>This is a front part of <a class="reference external" href="intro.html#identifier"><em>Identifier</em></a>.</dd></dl>

<dl class="attribute">
<dt id="berrymq.Message.action">
<tt class="descname">action</tt><a class="headerlink" href="#berrymq.Message.action" title="Permalink to this definition">¶</a></dt>
<dd>This is a back part of <a class="reference external" href="intro.html#identifier"><em>Identifier</em></a>.</dd></dl>

<dl class="attribute">
<dt id="berrymq.Message.id">
<tt class="descname">id</tt><a class="headerlink" href="#berrymq.Message.id" title="Permalink to this definition">¶</a></dt>
<dd>This is a string form of <a class="reference external" href="intro.html#identifier"><em>Identifier</em></a></dd></dl>

<dl class="attribute">
<dt id="berrymq.Message.args">
<tt class="descname">args</tt><a class="headerlink" href="#berrymq.Message.args" title="Permalink to this definition">¶</a></dt>
<dd><p>If you pass any parameters at <a title="berrymq.twitter" class="reference internal" href="#berrymq.twitter"><tt class="xref docutils literal"><span class="pre">twitter()</span></tt></a>, this attribute stores them.</p>
<div class="highlight-python"><pre>.
twitter("do_something:log", time.ctime())
.

@following("*:log)
def receive_log(message):
    print(message.args[0])  # print time.ctime() value</pre>
</div>
</dd></dl>

<dl class="attribute">
<dt id="berrymq.Message.kwargs">
<tt class="descname">kwargs</tt><a class="headerlink" href="#berrymq.Message.kwargs" title="Permalink to this definition">¶</a></dt>
<dd><p>It is similar to <a title="berrymq.Message.args" class="reference internal" href="#berrymq.Message.args"><tt class="xref docutils literal"><span class="pre">args</span></tt></a>. If you pass keyword argument,
you can access that value via this property.</p>
<div class="admonition-see-also admonition seealso">
<p class="first admonition-title">See also</p>
<p class="last"><a title="berrymq.Message.args" class="reference internal" href="#berrymq.Message.args"><tt class="xref docutils literal"><span class="pre">args</span></tt></a></p>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="berrymq.Queue">
<em class="property">class </em><tt class="descclassname">berrymq.</tt><tt class="descname">Queue</tt><a class="headerlink" href="#berrymq.Queue" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a key class of pull API for message receiving.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">queue</span> <span class="o">=</span> <span class="n">berrymq</span><span class="o">.</span><span class="n">Queue</span><span class="p">(</span><span class="s">&quot;task:*&quot;</span><span class="p">)</span>

<span class="c"># wait until someone send &quot;task:*&quot; message</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
<p>Method name of this class is similar to Python&#8217;s standard library.
This class doesn&#8217;t have <tt class="docutils literal"><span class="pre">put()</span></tt> method, because of all stored items
are sent by berryMQ. User uses this object just as message receiver.</p>
<dl class="method">
<dt id="berrymq.Queue.__init__">
<tt class="descname">__init__</tt><big>(</big><em>identifier</em><span class="optional">[</span>, <em>shared=False</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#berrymq.Queue.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Create new method queue.</p>
<p>If you pass <tt class="xref docutils literal"><span class="pre">True</span></tt> at <tt class="docutils literal"><span class="pre">shared</span></tt> flag,
new object become a <strong>shared</strong> queue. If there are some objects which has
same <a class="reference external" href="intro.html#identifier"><em>Identifier</em></a>, they share only one queue. If some object
<a title="berrymq.Queue.get" class="reference internal" href="#berrymq.Queue.get"><tt class="xref docutils literal"><span class="pre">get()</span></tt></a> value, others can&#8217;t get that message any more.</p>
<p>In another case, new object become a <strong>standalone</strong> queue. If there are
some objects which has same <a class="reference external" href="intro.html#identifier"><em>Identifier</em></a> and someone send
message which matches that identifier, all queues will store a copy of
that message.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameter:</th><td class="field-body"><em>identifier</em> &#8211; works as a filter. see <a class="reference external" href="intro.html#identifier"><em>Identifier</em></a>.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="berrymq.Queue.empty">
<tt class="descname">empty</tt><big>(</big><big>)</big><a class="headerlink" href="#berrymq.Queue.empty" title="Permalink to this definition">¶</a></dt>
<dd><p>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the queue object is empty.</p>
<p>If you use this class in concurrency envirionment, this result is not
reliable because other thread put new value after calling this method.</p>
</dd></dl>

<dl class="method">
<dt id="berrymq.Queue.full">
<tt class="descname">full</tt><big>(</big><big>)</big><a class="headerlink" href="#berrymq.Queue.full" title="Permalink to this definition">¶</a></dt>
<dd>Return <tt class="xref docutils literal"><span class="pre">True</span></tt> if the queue object is full. This return value is not
reliable because of same reason of <a title="berrymq.Queue.empty" class="reference internal" href="#berrymq.Queue.empty"><tt class="xref docutils literal"><span class="pre">empty()</span></tt></a>.</dd></dl>

<dl class="method">
<dt id="berrymq.Queue.qsize">
<tt class="descname">qsize</tt><big>(</big><big>)</big><a class="headerlink" href="#berrymq.Queue.qsize" title="Permalink to this definition">¶</a></dt>
<dd>Return stored item number. This return value is not
reliable because of same reason of <a title="berrymq.Queue.empty" class="reference internal" href="#berrymq.Queue.empty"><tt class="xref docutils literal"><span class="pre">empty()</span></tt></a>.</dd></dl>

<dl class="method">
<dt id="berrymq.Queue.get">
<tt class="descname">get</tt><big>(</big><span class="optional">[</span><em>block=True</em><span class="optional">[</span>, <em>timeout=None</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#berrymq.Queue.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Return stored message. This is a FIFO queue.</p>
<p>If <tt class="docutils literal"><span class="pre">block</span></tt> is <tt class="xref docutils literal"><span class="pre">True</span></tt> (defalut), function call is blocked while
new message received. If <tt class="xref docutils literal"><span class="pre">False</span></tt> it returns immediately even if
the queue is empty.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><em>block</em> (True of False) &#8211; Blocking mode flag.</li>
<li><em>timeout</em> &#8211; Set timeout[sec]. It is used in blocking mode.</li>
</ul>
</td>
</tr>
<tr class="field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">stored <a title="berrymq.Message" class="reference internal" href="#berrymq.Message"><tt class="xref docutils literal"><span class="pre">Message</span></tt></a> object</p>
</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Future release supports priority queue.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="berrymq.Queue.get_nowait">
<tt class="descname">get_nowait</tt><big>(</big><big>)</big><a class="headerlink" href="#berrymq.Queue.get_nowait" title="Permalink to this definition">¶</a></dt>
<dd>This method is alias of <tt class="docutils literal"><span class="pre">get(block=False)</span></tt>.</dd></dl>

</dd></dl>

<dl class="exception">
<dt id="berrymq.Empty">
<em class="property">exception </em><tt class="descclassname">berrymq.</tt><tt class="descname">Empty</tt><a class="headerlink" href="#berrymq.Empty" title="Permalink to this definition">¶</a></dt>
<dd>This is a same class of <tt class="xref docutils literal"><span class="pre">queue.Empty</span></tt>.
Its object is raised by <a title="berrymq.Queue.get" class="reference internal" href="#berrymq.Queue.get"><tt class="xref docutils literal"><span class="pre">Queue.get()</span></tt></a></dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">Python API</a><ul>
<li><a class="reference external" href="#decorators">Decorators</a></li>
<li><a class="reference external" href="#functions">Functions</a></li>
<li><a class="reference external" href="#classes">Classes</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="intro.html"
                                  title="previous chapter">Introduction</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="rubyapi.html"
                                  title="next chapter">Ruby API</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/pythonapi.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="modindex.html" title="Global Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="rubyapi.html" title="Ruby API"
             >next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction"
             >previous</a> |</li>
        <li><a href="index.html">berryMQ top</a>&nbsp;|&nbsp;</li>
 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2009, SHIBUKAWA Yoshiki.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.3.
    </div>
  </body>
</html>